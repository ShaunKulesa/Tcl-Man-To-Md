<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><link rel="canonical" href="https://www.tcl.tk/man/TkLib/SetOptions/" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>NAME - Tcl/Tk</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "NAME";
        var mkdocs_page_input_path = "TkLib\\SetOptions.md";
        var mkdocs_page_url = "/man/TkLib/SetOptions/";
      </script>
    
    <script src="../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Tcl/Tk
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption"><span class="caption-text">Home</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../..">Tcl/Tk</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ItclCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ItclCmd/">ItclCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ItclLib</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ItclLib/">ItclLib</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Keywords</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../Keywords/">Keywords</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">SqliteCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../SqliteCmd/">SqliteCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TclCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TclCmd/">TclCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TclLib</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TclLib/">TclLib</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TdbcCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TdbcCmd/">TdbcCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TdbcLib</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TdbcLib/">TdbcLib</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TdbcmysqlCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TdbcmysqlCmd/">TdbcmysqlCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TdbcodbcCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TdbcodbcCmd/">TdbcodbcCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TdbcpostgresCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TdbcpostgresCmd/">TdbcpostgresCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">ThreadCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../ThreadCmd/">ThreadCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TkCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../TkCmd/">TkCmd</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">TkLib</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../">TkLib</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">UserCmd</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../UserCmd/">UserCmd</a>
                </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Tcl/Tk</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a> &raquo;</li>
      <li>NAME</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="name">NAME</h1>
<p>Tk_CreateOptionTable, Tk_DeleteOptionTable, Tk_InitOptions,
Tk_SetOptions, Tk_FreeSavedOptions, Tk_RestoreSavedOptions,
Tk_GetOptionValue, Tk_GetOptionInfo, Tk_FreeConfigOptions, Tk_Offset -
process configuration options</p>
<h1 id="synopsis">SYNOPSIS</h1>
<p><strong>#include \&lt;tk.h></strong></p>
<p>Tk_OptionTable <strong>Tk_CreateOptionTable(</strong><em>interp, templatePtr</em><strong>)</strong></p>
<p><strong>Tk_DeleteOptionTable(</strong><em>optionTable</em><strong>)</strong></p>
<p>int <strong>Tk_InitOptions(</strong><em>interp, recordPtr, optionTable, tkwin</em><strong>)</strong></p>
<p>int <strong>Tk_SetOptions(</strong><em>interp, recordPtr, optionTable, objc, objv,
tkwin, savePtr, maskPtr</em><strong>)</strong></p>
<p><strong>Tk_FreeSavedOptions(</strong><em>savedPtr</em><strong>)</strong></p>
<p><strong>Tk_RestoreSavedOptions(</strong><em>savedPtr</em><strong>)</strong></p>
<p>Tcl_Obj * <strong>Tk_GetOptionValue(</strong><em>interp, recordPtr, optionTable,
namePtr, tkwin</em><strong>)</strong></p>
<p>Tcl_Obj * <strong>Tk_GetOptionInfo(</strong><em>interp, recordPtr, optionTable,
namePtr, tkwin</em><strong>)</strong></p>
<p><strong>Tk_FreeConfigOptions(</strong><em>recordPtr, optionTable, tkwin</em><strong>)</strong></p>
<p>int <strong>Tk_Offset(</strong><em>type, field</em><strong>)</strong></p>
<h1 id="arguments">ARGUMENTS</h1>
<p>A Tcl interpreter. Most procedures use this only for returning error
messages; if it is NULL then no error messages are returned. For
<strong>Tk_CreateOptionTable</strong> the value cannot be NULL; it gives the
interpreter in which the option table will be used.</p>
<p>Points to an array of static information that describes the
configuration options that are supported. Used to build a
Tk_OptionTable. The information pointed to by this argument must exist
for the lifetime of the Tk_OptionTable.</p>
<p>Token for an option table. Must have been returned by a previous call to
<strong>Tk_CreateOptionTable</strong>.</p>
<p>Points to structure in which values of configuration options are stored;
fields of this record are modified by procedures such as
<strong>Tk_SetOptions</strong> and read by procedures such as <strong>Tk_GetOptionValue</strong>.</p>
<p>For options such as <strong>TK_OPTION_COLOR</strong>, this argument indicates the
window in which the option will be used. If <em>optionTable</em> uses no
window-dependent options, then a NULL value may be supplied for this
argument.</p>
<p>Number of values in <em>objv</em>.</p>
<p>Command-line arguments for setting configuring options.</p>
<p>If not NULL, the structure pointed to by this argument is filled in with
the old values of any options that were modified and old values are
restored automatically if an error occurs in <strong>Tk_SetOptions</strong>.</p>
<p>If not NULL, the word pointed to by <em>maskPtr</em> is filled in with the
bit-wise OR of the <em>typeMask</em> fields for the options that were modified.</p>
<p>Points to a structure previously filled in by <strong>Tk_SetOptions</strong> with old
values of modified options.</p>
<p>The value of this object is the name of a particular option. If NULL is
passed to <strong>Tk_GetOptionInfo</strong> then information is returned for all
options. Must not be NULL when <strong>Tk_GetOptionValue</strong> is called.</p>
<p>The name of the type of a record.</p>
<p>The name of a field in records of type <em>type</em>.</p>
<h1 id="description">DESCRIPTION</h1>
<p>These procedures handle most of the details of parsing configuration
options such as those for Tk widgets. Given a description of what
options are supported, these procedures handle all the details of
parsing options and storing their values into a C structure associated
with the widget or object. The procedures were designed primarily for
widgets in Tk, but they can also be used for other kinds of objects that
have configuration options. In the rest of this manual page will be used
to refer to the object whose options are being managed; in practice the
object may not actually be a widget. The term is used to refer to the
C-level structure in which information about a particular widget or
object is stored.</p>
<p>Note: the easiest way to learn how to use these procedures is to look at
a working example. In Tk, the simplest example is the code that
implements the button family of widgets, which is in <strong>tkButton.c</strong>.
Other examples are in <strong>tkSquare.c</strong> and <strong>tkMenu.c</strong>.</p>
<p>In order to use these procedures, the code that implements the widget
must contain a static array of Tk_OptionSpec structures. This is a
template that describes the various options supported by that class of
widget; there is a separate template for each kind of widget. The
template contains information such as the name of each option, its type,
its default value, and where the value of the option is stored in the
widget record. See TEMPLATES below for more detail.</p>
<p>In order to process configuration options efficiently, the static
template must be augmented with additional information that is available
only at runtime. The procedure <strong>Tk_CreateOptionTable</strong> creates this
dynamic information from the template and returns a Tk_OptionTable token
that describes both the static and dynamic information. All of the other
procedures, such as <strong>Tk_SetOptions</strong>, take a Tk_OptionTable token as
argument. Typically, <strong>Tk_CreateOptionTable</strong> is called the first time
that a widget of a particular class is created and the resulting
Tk_OptionTable is used in the future for all widgets of that class. A
Tk_OptionTable may be used only in a single interpreter, given by the
<em>interp</em> argument to <strong>Tk_CreateOptionTable</strong>. When an option table is
no longer needed <strong>Tk_DeleteOptionTable</strong> should be called to free all
of its resources. All of the option tables for a Tcl interpreter are
freed automatically if the interpreter is deleted.</p>
<p><strong>Tk_InitOptions</strong> is invoked when a new widget is created to set the
default values for all of the widget\'s configuration options that do
not have <strong>TK_OPTION_DONT_SET_DEFAULT</strong> set in their <em>flags</em> field.
<strong>Tk_InitOptions</strong> is passed a token for an option table (<em>optionTable</em>)
and a pointer to a widget record (<em>recordPtr</em>), which is the C structure
that holds information about this widget. <strong>Tk_InitOptions</strong> uses the
information in the option table to choose an appropriate default for
each option, except those having <strong>TK_OPTION_DONT_SET_DEFAULT</strong> set,
then it stores the default value directly into the widget record,
overwriting any information that was already present in the widget
record. <strong>Tk_InitOptions</strong> normally returns <strong>TCL_OK</strong>. If an error
occurred while setting the default values (e.g., because a default value
was erroneous) then <strong>TCL_ERROR</strong> is returned and an error message is
left in <em>interp</em>\'s result if <em>interp</em> is not NULL.</p>
<p><strong>Tk_SetOptions</strong> is invoked to modify configuration options based on
information specified in a Tcl command. The command might be one that
creates a new widget, or a command that modifies options on an existing
widget. The <em>objc</em> and <em>objv</em> arguments describe the values of the
arguments from the Tcl command. <em>Objv</em> must contain an even number of
objects: the first object of each pair gives the name of an option and
the second object gives the new value for that option. <strong>Tk_SetOptions</strong>
looks up each name in <em>optionTable</em>, checks that the new value of the
option conforms to the type in <em>optionTable</em>, and stores the value of
the option into the widget record given by <em>recordPtr</em>.
<strong>Tk_SetOptions</strong> normally returns <strong>TCL_OK</strong>. If an error occurred
(such as an unknown option name or an illegal option value) then
<strong>TCL_ERROR</strong> is returned and an error message is left in <em>interp</em>\'s
result if <em>interp</em> is not NULL.</p>
<p><strong>Tk_SetOptions</strong> has two additional features. First, if the <em>maskPtr</em>
argument is not NULL then it points to an integer value that is filled
in with information about the options that were modified. For each
option in the template passed to <strong>Tk_CreateOptionTable</strong> there is a
<em>typeMask</em> field. The bits of this field are defined by the code that
implements the widget; for example, each bit might correspond to a
particular configuration option. Alternatively, bits might be used
functionally. For example, one bit might be used for redisplay: all
options that affect the widget\'s display, such that changing the option
requires the widget to be redisplayed, might have that bit set. Another
bit might indicate that the geometry of the widget must be recomputed,
and so on. <strong>Tk_SetOptions</strong> OR\'s together the <em>typeMask</em> fields from
all the options that were modified and returns this value at
*<em>maskPtr</em>; the caller can then use this information to optimize itself
so that, for example, it does not redisplay the widget if the modified
options do not affect the widget\'s appearance.</p>
<p>The second additional feature of <strong>Tk_SetOptions</strong> has to do with error
recovery. If an error occurs while processing configuration options,
this feature makes it possible to restore all the configuration options
to their previous values. Errors can occur either while processing
options in <strong>Tk_SetOptions</strong> or later in the caller. In many cases the
caller does additional processing after <strong>Tk_SetOptions</strong> returns; for
example, it might use an option value to set a trace on a variable and
may detect an error if the variable is an array instead of a scalar.
Error recovery is enabled by passing in a non-NULL value for the
<em>savePtr</em> argument to <strong>Tk_SetOptions</strong>; this should be a pointer to an
uninitialized Tk_SavedOptions structure on the caller\'s stack.
<strong>Tk_SetOptions</strong> overwrites the structure pointed to by <em>savePtr</em> with
information about the old values of any options modified by the
procedure. If <strong>Tk_SetOptions</strong> returns successfully, the caller uses
the structure in one of two ways. If the caller completes its processing
of the new options without any errors, then it must pass the structure
to <strong>Tk_FreeSavedOptions</strong> so that the old values can be freed. If the
caller detects an error in its processing of the new options, then it
should pass the structure to <strong>Tk_RestoreSavedOptions</strong>, which will copy
the old values back into the widget record and free the new values. If
<strong>Tk_SetOptions</strong> detects an error then it automatically restores any
options that had already been modified and leaves *<em>savePtr</em> in an
empty state: the caller need not call either <strong>Tk_FreeSavedOptions</strong> or
<strong>Tk_RestoreSavedOptions</strong>. If the <em>savePtr</em> argument to
<strong>Tk_SetOptions</strong> is NULL then <strong>Tk_SetOptions</strong> frees each old option
value immediately when it sets a new value for the option. In this case,
if an error occurs in the third option, the old values for the first two
options cannot be restored.</p>
<p><strong>Tk_GetOptionValue</strong> returns the current value of a configuration
option for a particular widget. The <em>namePtr</em> argument contains the name
of an option; <strong>Tk_GetOptionValue</strong> uses <em>optionTable</em> to lookup the
option and extract its value from the widget record pointed to by
<em>recordPtr</em>, then it returns an object containing that value. If an
error occurs (e.g., because <em>namePtr</em> contains an unknown option name)
then NULL is returned and an error message is left in <em>interp</em>\'s result
unless <em>interp</em> is NULL.</p>
<p><strong>Tk_GetOptionInfo</strong> returns information about configuration options in
a form suitable for <strong>configure</strong> widget commands. If the <em>namePtr</em>
argument is not NULL, it points to an object that gives the name of a
configuration option; <strong>Tk_GetOptionInfo</strong> returns an object containing
a list with five elements, which are the name of the option, the name
and class used for the option in the option database, the default value
for the option, and the current value for the option. If the <em>namePtr</em>
argument is NULL, then <strong>Tk_GetOptionInfo</strong> returns information about
all options in the form of a list of lists; each sublist describes one
option. Synonym options are handled differently depending on whether
<em>namePtr</em> is NULL: if <em>namePtr</em> is NULL then the sublist for each
synonym option has only two elements, which are the name of the option
and the name of the other option that it refers to; if <em>namePtr</em> is
non-NULL and names a synonym option then the object returned is the
five-element list for the other option that the synonym refers to. If an
error occurs (e.g., because <em>namePtr</em> contains an unknown option name)
then NULL is returned and an error message is left in <em>interp</em>\'s result
unless <em>interp</em> is NULL.</p>
<p><strong>Tk_FreeConfigOptions</strong> must be invoked when a widget is deleted. It
frees all of the resources associated with any of the configuration
options defined in <em>recordPtr</em> by <em>optionTable</em>.</p>
<p>The <strong>Tk_Offset</strong> macro is provided as a safe way of generating the
<em>objOffset</em> and <em>internalOffset</em> values for entries in Tk_OptionSpec
structures. It takes two arguments: the name of a type of record, and
the name of a field in that record. It returns the byte offset of the
named field in records of the given type.</p>
<h1 id="templates">TEMPLATES</h1>
<p>The array of Tk_OptionSpec structures passed to <strong>Tk_CreateOptionTable</strong>
via its <em>templatePtr</em> argument describes the configuration options
supported by a particular class of widgets. Each structure specifies one
configuration option and has the following fields:</p>
<div class="language-text highlight"><pre><span></span><code>typedef struct {
    Tk_OptionType type;
    const char *optionName;
    const char *dbName;
    const char *dbClass;
    const char *defValue;
    int objOffset;
    int internalOffset;
    int flags;
    const void *clientData;
    int typeMask;
} Tk_OptionSpec;
</code></pre></div>
<p>The <em>type</em> field indicates what kind of configuration option this is
(e.g. <strong>TK_OPTION_COLOR</strong> for a color value, or <strong>TK_OPTION_INT</strong> for an
integer value). <em>Type</em> determines how the value of the option is parsed
(more on this below). The <em>optionName</em> field is a string such as
<strong>-font</strong> or <strong>-bg</strong>; it is the name used for the option in Tcl commands
and passed to procedures via the <em>objc</em> or <em>namePtr</em> arguments. The
<em>dbName</em> and <em>dbClass</em> fields are used by <strong>Tk_InitOptions</strong> to look up
a default value for this option in the option database; if <em>dbName</em> is
NULL then the option database is not used by <strong>Tk_InitOptions</strong> for this
option. The <em>defValue</em> field specifies a default value for this
configuration option if no value is specified in the option database.
The <em>objOffset</em> and <em>internalOffset</em> fields indicate where to store the
value of this option in widget records (more on this below); values for
the <em>objOffset</em> and <em>internalOffset</em> fields should always be generated
with the <strong>Tk_Offset</strong> macro. The <em>flags</em> field contains additional
information to control the processing of this configuration option (see
below for details). <em>ClientData</em> provides additional type-specific data
needed by certain types. For instance, for <strong>TK_OPTION_COLOR</strong> types,
<em>clientData</em> is a string giving the default value to use on monochrome
displays. See the descriptions of the different types below for details.
The last field, <em>typeMask</em>, is used by <strong>Tk_SetOptions</strong> to return
information about which options were modified; see the description of
<strong>Tk_SetOptions</strong> above for details.</p>
<p>When <strong>Tk_InitOptions</strong> and <strong>Tk_SetOptions</strong> store the value of an
option into the widget record, they can do it in either of two ways. If
the <em>objOffset</em> field of the Tk_OptionSpec is greater than or equal to
zero, then the value of the option is stored as a (Tcl_Obj *) at the
location in the widget record given by <em>objOffset</em>. If the
<em>internalOffset</em> field of the Tk_OptionSpec is greater than or equal to
zero, then the value of the option is stored in a type-specific internal
form at the location in the widget record given by <em>internalOffset</em>. For
example, if the option\'s type is <strong>TK_OPTION_INT</strong> then the internal
form is an integer. If the <em>objOffset</em> or <em>internalOffset</em> field is
negative then the value is not stored in that form. At least one of the
offsets must be greater than or equal to zero.</p>
<p>The <em>flags</em> field consists of one or more bits ORed together. The
following flags are supported:</p>
<p><strong>TK_OPTION_NULL_OK</strong></p>
<p>:   If this bit is set for an option then an empty string will be
    accepted as the value for the option and the resulting internal form
    will be a NULL pointer, a zero value, or <strong>None</strong>, depending on the
    type of the option. If the flag is not set then empty strings will
    result in errors. <strong>TK_OPTION_NULL_OK</strong> is typically used to allow a
    feature to be turned off entirely, e.g. set a cursor value to
    <strong>None</strong> so that a window simply inherits its parent\'s cursor. Not
    all option types support the <strong>TK_OPTION_NULL_OK</strong> flag; for those
    that do, there is an explicit indication of that fact in the
    descriptions below.</p>
<p><strong>TK_OPTION_DONT_SET_DEFAULT</strong></p>
<p>:   If this bit is set for an option then no default value will be set
    in <strong>Tk_InitOptions</strong> for this option. Neither the option database,
    nor any system default value, nor <em>optionTable</em> are used to give a
    default value to this option. Instead it is assumed that the caller
    has already supplied a default value in the widget code.</p>
<p>The <em>type</em> field of each Tk_OptionSpec structure determines how to parse
the value of that configuration option. The legal value for <em>type</em>, and
the corresponding actions, are described below. If the type requires a
<em>tkwin</em> value to be passed into procedures like <strong>Tk_SetOptions</strong>, or if
it uses the <em>clientData</em> field of the Tk_OptionSpec, then it is
indicated explicitly; if not mentioned, the type requires neither
<em>tkwin</em> nor <em>clientData</em>.</p>
<p><strong>TK_OPTION_ANCHOR</strong></p>
<p>:   The value must be a standard anchor position such as <strong>ne</strong> or
    <strong>center</strong>. The internal form is a Tk_Anchor value like the ones
    returned by <strong>Tk_GetAnchorFromObj</strong>.</p>
<p><strong>TK_OPTION_BITMAP</strong></p>
<p>:   The value must be a standard Tk bitmap name. The internal form is a
    Pixmap token like the ones returned by <strong>Tk_AllocBitmapFromObj</strong>.
    This option type requires <em>tkwin</em> to be supplied to procedures such
    as <strong>Tk_SetOptions</strong>, and it supports the <strong>TK_OPTION_NULL_OK</strong>
    flag.</p>
<p><strong>TK_OPTION_BOOLEAN</strong></p>
<p>:   The value must be a standard boolean value such as <strong>true</strong> or
    <strong>no</strong>. The internal form is an integer with value 0 or 1.</p>
<p><strong>TK_OPTION_BORDER</strong></p>
<p>:   The value must be a standard color name such as <strong>red</strong> or
    <strong>#ff8080</strong>. The internal form is a Tk_3DBorder token like the ones
    returned by <strong>Tk_Alloc3DBorderFromObj</strong>. This option type requires
    <em>tkwin</em> to be supplied to procedures such as <strong>Tk_SetOptions</strong>, and
    it supports the <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<p><strong>TK_OPTION_COLOR</strong></p>
<p>:   The value must be a standard color name such as <strong>red</strong> or
    <strong>#ff8080</strong>. The internal form is an (XColor *) token like the ones
    returned by <strong>Tk_AllocColorFromObj</strong>. This option type requires
    <em>tkwin</em> to be supplied to procedures such as <strong>Tk_SetOptions</strong>, and
    it supports the <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<p><strong>TK_OPTION_CURSOR</strong></p>
<p>:   The value must be a standard cursor name such as <strong>cross</strong> or
    <strong>\@foo</strong>. The internal form is a Tk_Cursor token like the ones
    returned by <strong>Tk_AllocCursorFromObj</strong>. This option type requires
    <em>tkwin</em> to be supplied to procedures such as <strong>Tk_SetOptions</strong>, and
    when the option is set the cursor for the window is changed by
    calling <strong>XDefineCursor</strong>. This option type also supports the
    <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<p><strong>TK_OPTION_CUSTOM</strong></p>
<p>:   This option allows applications to define new option types. The
    clientData field of the entry points to a structure defining the new
    option type. See the section <strong>CUSTOM OPTION TYPES</strong> below for
    details.</p>
<p><strong>TK_OPTION_DOUBLE</strong></p>
<p>:   The string value must be a floating-point number in the format
    accepted by <strong>strtol</strong>. The internal form is a C <strong>double</strong> value.
    This option type supports the <strong>TK_OPTION_NULL_OK</strong> flag; if a NULL
    value is set, the internal representation is set to zero.</p>
<p><strong>TK_OPTION_END</strong></p>
<p>:   Marks the end of the template. There must be a Tk_OptionSpec
    structure with <em>type</em> <strong>TK_OPTION_END</strong> at the end of each template.
    If the <em>clientData</em> field of this structure is not NULL, then it
    points to an additional array of Tk_OptionSpec\'s, which is itself
    terminated by another <strong>TK_OPTION_END</strong> entry. Templates may be
    chained arbitrarily deeply. This feature allows common options to be
    shared by several widget classes.</p>
<p><strong>TK_OPTION_FONT</strong></p>
<p>:   The value must be a standard font name such as <strong>Times 16</strong>. The
    internal form is a Tk_Font handle like the ones returned by
    <strong>Tk_AllocFontFromObj</strong>. This option type requires <em>tkwin</em> to be
    supplied to procedures such as <strong>Tk_SetOptions</strong>, and it supports
    the <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<p><strong>TK_OPTION_INT</strong></p>
<p>:   The string value must be an integer in the format accepted by
    <strong>strtol</strong> (e.g. <strong>0</strong> and <strong>0x</strong> prefixes may be used to specify
    octal or hexadecimal numbers, respectively). The internal form is a
    C <strong>int</strong> value.</p>
<p><strong>TK_OPTION_JUSTIFY</strong></p>
<p>:   The value must be a standard justification value such as <strong>left</strong>.
    The internal form is a Tk_Justify like the values returned by
    <strong>Tk_GetJustifyFromObj</strong>.</p>
<p><strong>TK_OPTION_PIXELS</strong></p>
<p>:   The value must specify a screen distance such as <strong>2i</strong> or <strong>6.4</strong>.
    The internal form is an integer value giving a distance in pixels,
    like the values returned by <strong>Tk_GetPixelsFromObj</strong>. Note: if the
    <em>objOffset</em> field is not used then information about the original
    value of this option will be lost. See <strong>OBJOFFSET VS.
    INTERNALOFFSET</strong> below for details. This option type supports the
    <strong>TK_OPTION_NULL_OK</strong> flag; if a NULL value is set, the internal
    representation is set to zero.</p>
<p><strong>TK_OPTION_RELIEF</strong></p>
<p>:   The value must be standard relief such as <strong>raised</strong>. The internal
    form is an integer relief value such as <strong>TK_RELIEF_RAISED</strong>. This
    option type supports the <strong>TK_OPTION_NULL_OK</strong> flag; if a NULL value
    is set, the internal representation is set to <strong>TK_RELIEF_NULL</strong>.</p>
<p><strong>TK_OPTION_STRING</strong></p>
<p>:   The value may be any string. The internal form is a (char *)
    pointer that points to a dynamically allocated copy of the value.
    This option type supports the <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<p><strong>TK_OPTION_STRING_TABLE</strong></p>
<p>:   For this type, <em>clientData</em> is a pointer to an array of strings
    suitable for passing to <strong>Tcl_GetIndexFromObj</strong>. The value must be
    one of the strings in the table, or a unique abbreviation of one of
    the strings. The internal form is an integer giving the index into
    the table of the matching string, like the return value from
    <strong>Tcl_GetStringFromObj</strong>. This option type supports the
    <strong>TK_OPTION_NULL_OK</strong> flag; if a NULL value is set, the internal
    representation is set to -1.</p>
<p><strong>TK_OPTION_SYNONYM</strong></p>
<p>:   This type is used to provide alternative names for an option (for
    example, <strong>-bg</strong> is often used as a synonym for <strong>-background</strong>).
    The <strong>clientData</strong> field is a string that gives the name of another
    option in the same table. Whenever the synonym option is used, the
    information from the other option will be used instead.</p>
<p><strong>TK_OPTION_WINDOW</strong></p>
<p>:   The value must be a window path name. The internal form is a
    <strong>Tk_Window</strong> token for the window. This option type requires
    <em>tkwin</em> to be supplied to procedures such as <strong>Tk_SetOptions</strong> (in
    order to identify the application), and it supports the
    <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<h1 id="storage-management-issues">STORAGE MANAGEMENT ISSUES</h1>
<p>If a field of a widget record has its offset stored in the <em>objOffset</em>
or <em>internalOffset</em> field of a Tk_OptionSpec structure then the
procedures described here will handle all of the storage allocation and
resource management issues associated with the field. When the value of
an option is changed, <strong>Tk_SetOptions</strong> (or <strong>Tk_FreeSavedOptions</strong>)
will automatically free any resources associated with the old value,
such as Tk_Fonts for <strong>TK_OPTION_FONT</strong> options or dynamically allocated
memory for <strong>TK_OPTION_STRING</strong> options. For an option stored as an
object using the <em>objOffset</em> field of a Tk_OptionSpec, the widget record
shares the object pointed to by the <em>objv</em> value from the call to
<strong>Tk_SetOptions</strong>. The reference count for this object is incremented
when a pointer to it is stored in the widget record and decremented when
the option is modified. When the widget is deleted
<strong>Tk_FreeConfigOptions</strong> should be invoked; it will free the resources
associated with all options and decrement reference counts for any
objects.</p>
<p>However, the widget code is responsible for storing NULL or <strong>None</strong> in
all pointer and token fields before invoking <strong>Tk_InitOptions</strong>. This is
needed to allow proper cleanup in the rare case where an error occurs in
<strong>Tk_InitOptions</strong>.</p>
<h1 id="objoffset-vs-internaloffset">OBJOFFSET VS. INTERNALOFFSET</h1>
<p>In most cases it is simplest to use the <em>internalOffset</em> field of a
Tk_OptionSpec structure and not the <em>objOffset</em> field. This makes the
internal form of the value immediately available to the widget code so
the value does not have to be extracted from an object each time it is
used. However, there are two cases where the <em>objOffset</em> field is
useful. The first case is for <strong>TK_OPTION_PIXELS</strong> options. In this
case, the internal form is an integer pixel value that is valid only for
a particular screen. If the value of the option is retrieved, it will be
returned as a simple number. For example, after the command <strong>.b
configure -borderwidth 2m</strong>, the command <strong>.b configure -borderwidth</strong>
might return 7, which is the integer pixel value corresponding to
<strong>2m</strong>. Unfortunately, this loses the original screen-independent value.
Thus for <strong>TK_OPTION_PIXELS</strong> options it is better to use the
<em>objOffset</em> field. In this case the original value of the option is
retained in the object and can be returned when the option is retrieved.
In most cases it is convenient to use the <em>internalOffset</em> field as
well, so that the integer value is immediately available for use in the
widget code (alternatively, <strong>Tk_GetPixelsFromObj</strong> can be used to
extract the integer value from the object whenever it is needed). Note:
the problem of losing information on retrievals exists only for
<strong>TK_OPTION_PIXELS</strong> options.</p>
<p>The second reason to use the <em>objOffset</em> field is in order to implement
new types of options not supported by these procedures. To implement a
new type of option, you can use <strong>TK_OPTION_STRING</strong> as the type in the
Tk_OptionSpec structure and set the <em>objOffset</em> field but not the
<em>internalOffset</em> field. Then, after calling <strong>Tk_SetOptions</strong>, convert
the object to internal form yourself.</p>
<h1 id="custom-option-types">CUSTOM OPTION TYPES</h1>
<p>Applications can extend the built-in configuration types with additional
configuration types by writing procedures to parse, print, free, and
restore saved copies of the type and creating a structure pointing to
those procedures:</p>
<div class="language-text highlight"><pre><span></span><code>typedef struct Tk_ObjCustomOption {
    char *name;
    Tk_CustomOptionSetProc *setProc;
    Tk_CustomOptionGetProc *getProc;
    Tk_CustomOptionRestoreProc *restoreProc;
    Tk_CustomOptionFreeProc *freeProc;
    ClientData clientData;
} Tk_ObjCustomOption;

typedef int Tk_CustomOptionSetProc(
    ClientData clientData,
    Tcl_Interp *interp,
    Tk_Window tkwin,
    Tcl_Obj **valuePtr,
    char *recordPtr,
    int internalOffset,
    char *saveInternalPtr,
    int flags);

typedef Tcl_Obj *Tk_CustomOptionGetProc(
    ClientData clientData,
    Tk_Window tkwin,
    char *recordPtr,
    int internalOffset);

typedef void Tk_CustomOptionRestoreProc(
    ClientData clientData,
    Tk_Window tkwin,
    char *internalPtr,
    char *saveInternalPtr);

typedef void Tk_CustomOptionFreeProc(
    ClientData clientData,
    Tk_Window tkwin,
    char *internalPtr);
</code></pre></div>
<p>The Tk_ObjCustomOption structure contains six fields: a name for the
custom option type; pointers to the four procedures; and a <em>clientData</em>
value to be passed to those procedures when they are invoked. The
<em>clientData</em> value typically points to a structure containing
information that is needed by the procedures when they are parsing and
printing options. <em>RestoreProc</em> and <em>freeProc</em> may be NULL, indicating
that no function should be called for those operations.</p>
<p>The <em>setProc</em> procedure is invoked by <strong>Tk_SetOptions</strong> to convert a
Tcl_Obj into an internal representation and store the resulting value in
the widget record. The arguments are:</p>
<blockquote>
<p><em>clientData</em></p>
<p>:   A copy of the <em>clientData</em> field in the Tk_ObjCustomOption
    structure.</p>
<p><em>interp</em></p>
<p>:   A pointer to a Tcl interpreter, used for error reporting.</p>
<p><em>Tkwin</em></p>
<p>:   A copy of the <em>tkwin</em> argument to <strong>Tk_SetOptions</strong></p>
<p><em>valuePtr</em></p>
<p>:   A pointer to a reference to a Tcl_Obj describing the new value for
    the option; it could have been specified explicitly in the call to
    <strong>Tk_SetOptions</strong> or it could come from the option database or a
    default. If the objOffset for the option is non-negative (the
    option value is stored as a (Tcl_Obj *) in the widget record),
    the Tcl_Obj pointer referenced by <em>valuePtr</em> is the pointer that
    will be stored at the objOffset for the option. <em>SetProc</em> may
    modify the value if necessary; for example, <em>setProc</em> may change
    the value to NULL to support the <strong>TK_OPTION_NULL_OK</strong> flag.</p>
<p><em>recordPtr</em></p>
<p>:   A pointer to the start of the widget record to modify.</p>
<p><em>internalOffset</em></p>
<p>:   Offset in bytes from the start of the widget record to the
    location where the internal representation of the option value is
    to be placed.</p>
<p><em>saveInternalPtr</em></p>
<p>:   A pointer to storage allocated in a Tk_SavedOptions structure for
    the internal representation of the original option value. Before
    setting the option to its new value, <em>setProc</em> should set the
    value referenced by <em>saveInternalPtr</em> to the original value of the
    option in order to support <strong>Tk_RestoreSavedOptions</strong>.</p>
<p><em>flags</em></p>
<p>:   A copy of the <em>flags</em> field in the Tk_OptionSpec structure for the
    option</p>
</blockquote>
<p><em>SetProc</em> returns a standard Tcl result: <strong>TCL_OK</strong> to indicate
successful processing, or <strong>TCL_ERROR</strong> to indicate a failure of any
kind. An error message may be left in the Tcl interpreter given by
<em>interp</em> in the case of an error.</p>
<p>The <em>getProc</em> procedure is invoked by <strong>Tk_GetOptionValue</strong> and
<strong>Tk_GetOptionInfo</strong> to retrieve a Tcl_Obj representation of the
internal representation of an option. The <em>clientData</em> argument is a
copy of the <em>clientData</em> field in the Tk_ObjCustomOption structure.
<em>Tkwin</em> is a copy of the <em>tkwin</em> argument to <strong>Tk_GetOptionValue</strong> or
<strong>Tk_GetOptionInfo</strong>. <em>RecordPtr</em> is a pointer to the beginning of the
widget record to query. <em>InternalOffset</em> is the offset in bytes from the
beginning of the widget record to the location where the internal
representation of the option value is stored. <em>GetProc</em> must return a
pointer to a Tcl_Obj representing the value of the option.</p>
<p>The <em>restoreProc</em> procedure is invoked by <strong>Tk_RestoreSavedOptions</strong> to
restore a previously saved internal representation of a custom option
value. The <em>clientData</em> argument is a copy of the <em>clientData</em> field in
the Tk_ObjCustomOption structure. <em>Tkwin</em> is a copy of the <em>tkwin</em>
argument to <strong>Tk_GetOptionValue</strong> or <strong>Tk_GetOptionInfo</strong>. <em>InternalPtr</em>
is a pointer to the location where internal representation of the option
value is stored. <em>SaveInternalPtr</em> is a pointer to the saved value.
<em>RestoreProc</em> must copy the value from <em>saveInternalPtr</em> to
<em>internalPtr</em> to restore the value. <em>RestoreProc</em> need not free any
memory associated with either <em>internalPtr</em> or <em>saveInternalPtr</em>;
<em>freeProc</em> will be invoked to free that memory if necessary.
<em>RestoreProc</em> has no return value.</p>
<p>The <em>freeProc</em> procedure is invoked by <strong>Tk_SetOptions</strong> and
<strong>Tk_FreeSavedOptions</strong> to free any storage allocated for the internal
representation of a custom option. The <em>clientData</em> argument is a copy
of the <em>clientData</em> field in the Tk_ObjCustomOption structure. <em>Tkwin</em>
is a copy of the <em>tkwin</em> argument to <strong>Tk_GetOptionValue</strong> or
<strong>Tk_GetOptionInfo</strong>. <em>InternalPtr</em> is a pointer to the location where
the internal representation of the option value is stored. The
<em>freeProc</em> must free any storage associated with the option. <em>FreeProc</em>
has no return value.</p>
<h1 id="keywords">KEYWORDS</h1>
<p>anchor, bitmap, boolean, border, color, configuration option, cursor,
double, font, integer, justify, pixels, relief, screen distance, synonym</p>
              
            </div>
          </div><footer>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
    
  </span>
</div>
    <script>var base_url = '../..';</script>
    <script src="../../js/theme_extra.js" defer></script>
    <script src="../../js/theme.js" defer></script>
      <script src="../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
