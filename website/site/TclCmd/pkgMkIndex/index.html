<!DOCTYPE html>
<html lang="en">
    <head>
      <script>
	// Hack for scrolling window when linking to anchor tag with fixed nav header
        var shiftWindow = function() { scrollBy(0, -75) };
        window.addEventListener("hashchange", shiftWindow);
        function load() { if (window.location.hash) shiftWindow(); }
      </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://www.tcl.tk/man/TclCmd/pkgMkIndex/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>pkgMkIndex - Tcl/Tk</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="../../js/base.js"></script> 
    </head>

    <body class="">

      <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
	<div class="container">
	<a class="navbar-brand" href="../..">Tcl/Tk</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse">

          <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
            <li class="nav-item">
              <a class="nav-link" href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
		<i class="fa fa-search"></i> Search
              </a>
            </li>
          </ul>
	</div>
	</div>
      </nav><div id="content" class="container">
        
      <div class="row">
        <div class="col-md-9" role="main">


<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    
    <li class="breadcrumb-item active" aria-current="page">pkgMkIndex</li>
  </ol>
</nav>


<p>\</p>
<h1 id="name">NAME</h1>
<p>pkg_mkIndex - Build an index for automatic loading of packages</p>
<h1 id="synopsis">SYNOPSIS</h1>
<p><strong>pkg_mkIndex</strong> ?<em>options...</em>? <em>dir</em> ?<em>pattern pattern ...</em>?</p>
<p>\</p>
<h1 id="description">DESCRIPTION</h1>
<p><strong>Pkg_mkIndex</strong> is a utility procedure that is part of the standard Tcl
library. It is used to create index files that allow packages to be
loaded automatically when <strong>package require</strong> commands are executed. To
use <strong>pkg_mkIndex</strong>, follow these steps:</p>
<p>[1]</p>
<p>:   Create the package(s). Each package may consist of one or more Tcl
    script files or binary files. Binary files must be suitable for
    loading with the <strong>load</strong> command with a single argument; for
    example, if the file is <strong>test.so</strong> it must be possible to load this
    file with the command <strong>load test.so</strong>. Each script file must
    contain a <strong>package provide</strong> command to declare the package and
    version number, and each binary file must contain a call to
    <strong>Tcl_PkgProvide</strong>.</p>
<p>[2]</p>
<p>:   Create the index by invoking <strong>pkg_mkIndex</strong>. The <em>dir</em> argument
    gives the name of a directory and each <em>pattern</em> argument is a
    <strong>glob</strong>-style pattern that selects script or binary files in <em>dir</em>.
    The default pattern is <strong>*.tcl</strong> and <strong>*.[info
    sharedlibextension]</strong>.</p>
<div class="language-text highlight"><pre><span></span><code>**Pkg_mkIndex** will create a file **pkgIndex.tcl** in *dir* with
package information about all the files given by the *pattern*
arguments. It does this by loading each file into a child
interpreter and seeing what packages and new commands appear (this
is why it is essential to have **package provide** commands or
**Tcl_PkgProvide** calls in the files, as described above). If you
have a package split among scripts and binary files, or if you have
dependencies among files, you may have to use the **-load** option
or adjust the order in which **pkg_mkIndex** processes the files.
See **COMPLEX CASES** below.
</code></pre></div>
<p>[3]</p>
<p>:   Install the package as a subdirectory of one of the directories
    given by the <strong>tcl_pkgPath</strong> variable. If <strong>\$tcl_pkgPath</strong> contains
    more than one directory, machine-dependent packages (e.g., those
    that contain binary shared libraries) should normally be installed
    under the first directory and machine-independent packages (e.g.,
    those that contain only Tcl scripts) should be installed under the
    second directory. The subdirectory should include the package\'s
    script and/or binary files as well as the <strong>pkgIndex.tcl</strong> file. As
    long as the package is installed as a subdirectory of a directory in
    <strong>\$tcl_pkgPath</strong> it will automatically be found during <strong>package
    require</strong> commands.</p>
<div class="language-text highlight"><pre><span></span><code>If you install the package anywhere else, then you must ensure that
the directory containing the package is in the **auto_path** global
variable or an immediate subdirectory of one of the directories in
**auto_path**. **Auto_path** contains a list of directories that are
searched by both the auto-loader and the package loader; by default
it includes **\$tcl_pkgPath**. The package loader also checks all of
the subdirectories of the directories in **auto_path**. You can add
a directory to **auto_path** explicitly in your application, or you
can add the directory to your **TCLLIBPATH** environment variable:
if this environment variable is present, Tcl initializes
**auto_path** from it during application startup.
</code></pre></div>
<p>[4]</p>
<p>:   Once the above steps have been taken, all you need to do to use a
    package is to invoke <strong>package require</strong>. For example, if versions
    2.1, 2.3, and 3.1 of package <strong>Test</strong> have been indexed by
    <strong>pkg_mkIndex</strong>, the command <strong>package require Test</strong> will make
    version 3.1 available and the command <strong>package require -exact Test
    2.1</strong> will make version 2.1 available. There may be many versions of
    a package in the various index files in <strong>auto_path</strong>, but only one
    will actually be loaded in a given interpreter, based on the first
    call to <strong>package require</strong>. Different versions of a package may be
    loaded in different interpreters.</p>
<h1 id="options">OPTIONS</h1>
<p>The optional switches are:</p>
<p><strong>-direct</strong></p>
<p>:   The generated index will implement direct loading of the package
    upon <strong>package require</strong>. This is the default.</p>
<p><strong>-lazy</strong></p>
<p>:   The generated index will manage to delay loading the package until
    the use of one of the commands provided by the package, instead of
    loading it immediately upon <strong>package require</strong>. This is not
    compatible with the use of <em>auto_reset</em>, and therefore its use is
    discouraged.</p>
<p><strong>-load </strong><em>pkgPat</em></p>
<p>:   The index process will pre-load any packages that exist in the
    current interpreter and match <em>pkgPat</em> into the child interpreter
    used to generate the index. The pattern match uses string match
    rules, but without making case distinctions. See <strong>COMPLEX CASES</strong>
    below.</p>
<p><strong>-verbose</strong></p>
<p>:   Generate output during the indexing process. Output is via the
    <strong>tclLog</strong> procedure, which by default prints to stderr.</p>
<p><strong>--</strong></p>
<p>:   End of the flags, in case <em>dir</em> begins with a dash.</p>
<h1 id="packages-and-the-auto-loader">PACKAGES AND THE AUTO-LOADER</h1>
<p>The package management facilities overlap somewhat with the auto-loader,
in that both arrange for files to be loaded on-demand. However, package
management is a higher-level mechanism that uses the auto-loader for the
last step in the loading process. It is generally better to index a
package with <strong>pkg_mkIndex</strong> rather than <strong>auto_mkindex</strong> because the
package mechanism provides version control: several versions of a
package can be made available in the index files, with different
applications using different versions based on <strong>package require</strong>
commands. In contrast, <strong>auto_mkindex</strong> does not understand versions so
it can only handle a single version of each package. It is probably not
a good idea to index a given package with both <strong>pkg_mkIndex</strong> and
<strong>auto_mkindex</strong>. If you use <strong>pkg_mkIndex</strong> to index a package, its
commands cannot be invoked until <strong>package require</strong> has been used to
select a version; in contrast, packages indexed with <strong>auto_mkindex</strong>
can be used immediately since there is no version control.</p>
<h1 id="how-it-works">HOW IT WORKS</h1>
<p><strong>Pkg_mkIndex</strong> depends on the <strong>package unknown</strong> command, the
<strong>package ifneeded</strong> command, and the auto-loader. The first time a
<strong>package require</strong> command is invoked, the <strong>package unknown</strong> script
is invoked. This is set by Tcl initialization to a script that evaluates
all of the <strong>pkgIndex.tcl</strong> files in the <strong>auto_path</strong>. The
<strong>pkgIndex.tcl</strong> files contain <strong>package ifneeded</strong> commands for each
version of each available package; these commands invoke <strong>package
provide</strong> commands to announce the availability of the package, and they
setup auto-loader information to load the files of the package. If the
<strong>-lazy</strong> flag was provided when the <strong>pkgIndex.tcl</strong> was generated, a
given file of a given version of a given package is not actually loaded
until the first time one of its commands is invoked. Thus, after
invoking <strong>package require</strong> you may not see the package\'s commands in
the interpreter, but you will be able to invoke the commands and they
will be auto-loaded.</p>
<h1 id="direct-loading">DIRECT LOADING</h1>
<p>Some packages, for instance packages which use namespaces and export
commands or those which require special initialization, might select
that their package files be loaded immediately upon <strong>package require</strong>
instead of delaying the actual loading to the first use of one of the
package\'s command. This is the default mode when generating the package
index. It can be overridden by specifying the <strong>-lazy</strong> argument.</p>
<h1 id="complex-cases">COMPLEX CASES</h1>
<p>Most complex cases of dependencies among scripts and binary files, and
packages being split among scripts and binary files are handled OK.
However, you may have to adjust the order in which files are processed
by <strong>pkg_mkIndex</strong>. These issues are described in detail below.</p>
<p>If each script or file contains one package, and packages are only
contained in one file, then things are easy. You simply specify all
files to be indexed in any order with some glob patterns.</p>
<p>In general, it is OK for scripts to have dependencies on other packages.
If scripts contain <strong>package require</strong> commands, these are stubbed out
in the interpreter used to process the scripts, so these do not cause
problems. If scripts call into other packages in global code, these
calls are handled by a stub <strong>unknown</strong> command. However, if scripts
make variable references to other package\'s variables in global code,
these will cause errors. That is also bad coding style.</p>
<p>If binary files have dependencies on other packages, things can become
tricky because it is not possible to stub out C-level APIs such as
<strong>Tcl_PkgRequire</strong> API when loading a binary file. For example, suppose
the BLT package requires Tk, and expresses this with a call to
<strong>Tcl_PkgRequire</strong> in its <strong>Blt_Init</strong> routine. To support this, you
must run <strong>pkg_mkIndex</strong> in an interpreter that has Tk loaded. You can
achieve this with the <strong>-load </strong><em>pkgPat</em> option. If you specify this
option, <strong>pkg_mkIndex</strong> will load any packages listed by <strong>info loaded</strong>
and that match <em>pkgPat</em> into the interpreter used to process files. In
most cases this will satisfy the <strong>Tcl_PkgRequire</strong> calls made by binary
files.</p>
<p>If you are indexing two binary files and one depends on the other, you
should specify the one that has dependencies last. This way the one
without dependencies will get loaded and indexed, and then the package
it provides will be available when the second file is processed. You may
also need to load the first package into the temporary interpreter used
to create the index by using the <strong>-load</strong> flag; it will not hurt to
specify package patterns that are not yet loaded.</p>
<p>If you have a package that is split across scripts and a binary file,
then you should avoid the <strong>-load</strong> flag. The problem is that if you
load a package before computing the index it masks any other files that
provide part of the same package. If you must use <strong>-load</strong>, then you
must specify the scripts first; otherwise the package loaded from the
binary file may mask the package defined by the scripts.</p>
<h1 id="see-also">SEE ALSO</h1>
<p>package(n)</p>
<h1 id="keywords">KEYWORDS</h1>
<p>auto-load, index, package, version</p>

<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
  <li class="last-updated-holder displayDate loading">
    <span class="last-updated-text">Last updated:</span>
    <time role="presentation" datetime="2018-10-25T00:00:00.000Z" data-article-date-source="ms.date"></time>
  </li>
<!--
  <li class="readingTime">
    2 minutes to read
  </li>
-->
  <li class="contributors-holder">
    <span class="contributors-text">Contributors</span>
    <ul class="contributors" data-bi-name="contributors"></ul>
  </li>
</ul>
</div>
        <div class="col-md-3"><div class="navbar-light navbar-expand-md hidden-print sticky-top sticky-offset" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    <div id="toc-collapse" class="navbar-collapse collapse card">
        <ul class="nav flex-column bs-sidenav">
            <li class="nav-item main"><a class="nav-link" href="#name">NAME</a></li>
            <li class="nav-item main"><a class="nav-link" href="#synopsis">SYNOPSIS</a></li>
            <li class="nav-item main"><a class="nav-link" href="#description">DESCRIPTION</a></li>
            <li class="nav-item main"><a class="nav-link" href="#options">OPTIONS</a></li>
            <li class="nav-item main"><a class="nav-link" href="#packages-and-the-auto-loader">PACKAGES AND THE AUTO-LOADER</a></li>
            <li class="nav-item main"><a class="nav-link" href="#how-it-works">HOW IT WORKS</a></li>
            <li class="nav-item main"><a class="nav-link" href="#direct-loading">DIRECT LOADING</a></li>
            <li class="nav-item main"><a class="nav-link" href="#complex-cases">COMPLEX CASES</a></li>
            <li class="nav-item main"><a class="nav-link" href="#see-also">SEE ALSO</a></li>
            <li class="nav-item main"><a class="nav-link" href="#keywords">KEYWORDS</a></li>
        </ul>
    </div>
</div></div>
      </div>
      </div>

      <footer class="col-md-12">
	<hr>
	<div class="container">
	</div>
      </footer>
      <script>
	var base_url = "../..",
            shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
      </script>
      <script src="../../js/base.js" defer></script>
      <script src="../../search/main.js" defer></script>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <p class="h4 modal-title">Keyboard Shortcuts</p>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
