<!DOCTYPE html>
<html lang="en">
    <head>
      <script>
	// Hack for scrolling window when linking to anchor tag with fixed nav header
        var shiftWindow = function() { scrollBy(0, -75) };
        window.addEventListener("hashchange", shiftWindow);
        function load() { if (window.location.hash) shiftWindow(); }
      </script>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        <link rel="canonical" href="https://www.tcl.tk/man/TclLib/TCL_MEM_DEBUG/">
        <link rel="shortcut icon" href="../../img/favicon.ico">
        <title>TCL MEM DEBUG - Tcl/Tk</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <link href="../../css/font-awesome.min.css" rel="stylesheet">
    <link href="../../css/base.css" rel="stylesheet">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>
    <script src="../../js/base.js"></script> 
    </head>

    <body class="">

      <nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
	<div class="container">
	<a class="navbar-brand" href="../..">Tcl/Tk</a>
	<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample04" aria-controls="navbarsExample04" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
	</button>

	<div class="collapse navbar-collapse">

          <ul class="navbar-nav flex-row ml-md-auto d-none d-md-flex">
            <li class="nav-item">
              <a class="nav-link" href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
		<i class="fa fa-search"></i> Search
              </a>
            </li>
          </ul>
	</div>
	</div>
      </nav><div id="content" class="container">
        
      <div class="row">
        <div class="col-md-9" role="main">


<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    
    <li class="breadcrumb-item active" aria-current="page">TCL MEM DEBUG</li>
  </ol>
</nav>


<p>\</p>
<h1 id="name">NAME</h1>
<p>TCL_MEM_DEBUG - Compile-time flag to enable Tcl memory debugging</p>
<p>\</p>
<h1 id="description">DESCRIPTION</h1>
<p>When Tcl is compiled with <strong>TCL_MEM_DEBUG</strong> defined, a powerful set of
memory debugging aids is included in the compiled binary. This includes
C and Tcl functions which can aid with debugging memory leaks, memory
allocation overruns, and other memory related errors.</p>
<h1 id="enabling-memory-debugging">ENABLING MEMORY DEBUGGING</h1>
<p>To enable memory debugging, Tcl should be recompiled from scratch with
<strong>TCL_MEM_DEBUG</strong> defined (e.g. by passing the <em>--enable-symbols=mem</em>
flag to the <em>configure</em> script when building). This will also compile in
a non-stub version of <strong>Tcl_InitMemory</strong> to add the <strong>memory</strong> command
to Tcl.</p>
<p><strong>TCL_MEM_DEBUG</strong> must be either left defined for all modules or
undefined for all modules that are going to be linked together. If they
are not, link errors will occur, with either <strong>Tcl_DbCkfree</strong> and
<strong>Tcl_DbCkalloc</strong> or <strong>Tcl_Alloc</strong> and <strong>Tcl_Free</strong> being undefined.</p>
<p>Once memory debugging support has been compiled into Tcl, the C
functions <strong>Tcl_ValidateAllMemory</strong>, and <strong>Tcl_DumpActiveMemory</strong>, and
the Tcl <strong>memory</strong> command can be used to validate and examine memory
usage.</p>
<h1 id="guard-zones">GUARD ZONES</h1>
<p>When memory debugging is enabled, whenever a call to <strong>ckalloc</strong> is
made, slightly more memory than requested is allocated so the memory
debugging code can keep track of the allocated memory, and eight-byte
are placed in front of and behind the space that will be returned to the
caller. (The sizes of the guard zones are defined by the C #define
<strong>LOW_GUARD_SIZE</strong> and #define <strong>HIGH_GUARD_SIZE</strong> in the file
<em>generic/tclCkalloc.c</em> --- it can be extended if you suspect large
overwrite problems, at some cost in performance.) A known pattern is
written into the guard zones and, on a call to <strong>ckfree</strong>, the guard
zones of the space being freed are checked to see if either zone has
been modified in any way. If one has been, the guard bytes and their new
contents are identified, and a or message is issued. The message
includes the address of the memory packet and the file name and line
number of the code that called <strong>ckfree</strong>. This allows you to detect the
common sorts of one-off problems, where not enough space was allocated
to contain the data written, for example.</p>
<h1 id="debugging-difficult-memory-corruption-problems">DEBUGGING DIFFICULT MEMORY CORRUPTION PROBLEMS</h1>
<p>Normally, Tcl compiled with memory debugging enabled will make it easy
to isolate a corruption problem. Turning on memory validation with the
memory command can help isolate difficult problems. If you suspect (or
know) that corruption is occurring before the Tcl interpreter comes up
far enough for you to issue commands, you can set <strong>MEM_VALIDATE</strong>
define, recompile tclCkalloc.c and rebuild Tcl. This will enable memory
validation from the first call to <strong>ckalloc</strong>, again, at a large
performance impact.</p>
<p>If you are desperate and validating memory on every call to <strong>ckalloc</strong>
and <strong>ckfree</strong> is not enough, you can explicitly call
<strong>Tcl_ValidateAllMemory</strong> directly at any point. It takes a <em>char</em> *
and an <em>int</em> which are normally the filename and line number of the
caller, but they can actually be anything you want. Remember to remove
the calls after you find the problem.</p>
<h1 id="see-also">SEE ALSO</h1>
<p>ckalloc, memory, Tcl_ValidateAllMemory, Tcl_DumpActiveMemory</p>
<h1 id="keywords">KEYWORDS</h1>
<p>memory, debug</p>

<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr">
  <li class="last-updated-holder displayDate loading">
    <span class="last-updated-text">Last updated:</span>
    <time role="presentation" datetime="2018-10-25T00:00:00.000Z" data-article-date-source="ms.date"></time>
  </li>
<!--
  <li class="readingTime">
    2 minutes to read
  </li>
-->
  <li class="contributors-holder">
    <span class="contributors-text">Contributors</span>
    <ul class="contributors" data-bi-name="contributors"></ul>
  </li>
</ul>
</div>
        <div class="col-md-3"><div class="navbar-light navbar-expand-md hidden-print sticky-top sticky-offset" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    <div id="toc-collapse" class="navbar-collapse collapse card">
        <ul class="nav flex-column bs-sidenav">
            <li class="nav-item main"><a class="nav-link" href="#name">NAME</a></li>
            <li class="nav-item main"><a class="nav-link" href="#description">DESCRIPTION</a></li>
            <li class="nav-item main"><a class="nav-link" href="#enabling-memory-debugging">ENABLING MEMORY DEBUGGING</a></li>
            <li class="nav-item main"><a class="nav-link" href="#guard-zones">GUARD ZONES</a></li>
            <li class="nav-item main"><a class="nav-link" href="#debugging-difficult-memory-corruption-problems">DEBUGGING DIFFICULT MEMORY CORRUPTION PROBLEMS</a></li>
            <li class="nav-item main"><a class="nav-link" href="#see-also">SEE ALSO</a></li>
            <li class="nav-item main"><a class="nav-link" href="#keywords">KEYWORDS</a></li>
        </ul>
    </div>
</div></div>
      </div>
      </div>

      <footer class="col-md-12">
	<hr>
	<div class="container">
	</div>
      </footer>
      <script>
	var base_url = "../..",
            shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
      </script>
      <script src="../../js/base.js" defer></script>
      <script src="../../search/main.js" defer></script>

      <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <p class="h4 modal-title">Keyboard Shortcuts</p>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
